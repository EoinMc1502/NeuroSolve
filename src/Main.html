<!DOCTYPE html>
<html>
<head>
    <title>Neuro Solves</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #333;
            color: white;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 95%;
            margin: auto;
            overflow: hidden;
        }
        header {
            background: #222;
            color: white;
            padding-top: 30px;
            min-height: 70px;
            border-bottom: white 3px solid;
        }
        header a {
            color: #ffffff;
            text-decoration: none;
            text-transform: uppercase;
            font-size: 16px;
        }
        header ul {
            padding: 0;
            margin: 0;
            list-style: none;
            overflow: hidden;
        }
        header li {
            float: left;
            display: inline;
            padding: 0 20px 0 20px;
        }
        header #branding {
            float: left;
        }
        header #branding h1 {
            margin: 0;
        }
        header nav {
            float: right;
            margin-top: 10px;
        }
        header a:hover {
            color: #ffffff;
            font-weight: bold;
        }
        .button {
            height: 50px;
            background: #555;
            border: 0;
            padding-left: 50px;
            padding-right: 50px;
            color: #ffffff;
        }
        .button:hover {
            background: #777;
            cursor: pointer;
        }
        form {
            margin-top: 20px;
            line-height: 2.5;
        }
        label {
            display: block;
            margin-bottom: 10px;
        }
        input[type="text"], input[type="date"], select, textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #555;
            background: #222;
            color: white;
            box-sizing: border-box;
        }
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        .message-box {
            position: fixed; /* Or absolute, depending on your needs */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
        }
        .message-content {
            background-color: #333; /* Dark background for the message */
            color: #fff; /* Light text color for contrast */
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); /* Soft shadow for depth */
            max-width: 650px; /* Adjust based on your content */
            width: 90%; /* Responsive width */
            max-height: 70%; /* Maximum height before scrolling */
            overflow-y: auto; /* Enable vertical scrolling */
            position: relative; /* Needed for proper positioning of close button */
        }

        .close-btn {
            float: right;
            font-size: 28px;
            font-weight: bold;
            color: #aaa; /* Light grey color for the close button */
            cursor: pointer;
        }
        .close-btn:hover {
            color: #fff; /* White color on hover for the close button */
        }
        .select-container {
            display: flex;
            justify-content: space-between; /* This spreads the children evenly */
            align-items: flex-start; /* Aligns items at the start of the container */
            margin-bottom: 20px; /* Optional: adds some space below the container */
        }

        .select-wrapper {
            flex: 1; /* Each child will take up equal amount of space */
            margin-right: 10px; /* Optional: adds some space between the select elements */
        }

        .select-wrapper:last-child {
            margin-right: 0; /* Removes margin from the last select element */
        }
        #DuplicateContainerButton {
            height: 40px; /* Slightly smaller height compared to the submit button for differentiation */
            background-color: #444; /* Darker than the main button, but lighter than the background */
            color: #ccc; /* Light grey color for visibility against the dark background */
            font-size: 16px;
            font-weight: bold;
            border: none; /* Removes the default border */
            cursor: pointer; /* Changes cursor to pointer on hover */
            margin-top: 20px; /* Adds space between the selects and the button */
            width: 100%; /* Ensures the button stretches to match the form's width */
            transition: background-color 0.3s, color 0.3s; /* Smooth transition for hover effects */
        }

        #DuplicateContainerButton:hover {
            background-color: #555; /* Lightens the button on hover for feedback */
            color: #fff; /* Makes the text color brighter on hover */
        }
        .symptoms-select {
            height: 250px; /* Adjust the height as needed */
            overflow-y: auto; /* Enables vertical scrolling if there are many options */
        }
        .extra-space {
            height: 30px; /* Adjust the height as needed */
        }
    </style>
</head>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    function submitForm() {
        
        console.log('Submitting form...');
        const formData = {
            patientTitle: $('#patientTitle').val(),
            patientFirstName: $('#patientFirstName').val(),
            patientLastName: $('#patientLastName').val(),
            streetAddress: $('#streetAddress').val(),
            city: $('#city').val(),
            state: $('#state').val(),
            postalCode: $('#postalCode').val(),
            country: $('#country').val(),
            dateOfBirth: $('#dateOfBirth').val(),
            familyHistory: gatherFamilyHistoryData(),
            symptoms: $('#symptoms').val(),
            testResults: $('#testResults').val()
        };

        console.log('Form Data:', formData);

        $.ajax({
            url: 'http://localhost:3000/submit-form',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function (response) {
                
                showDiagnosisProcess(JSON.stringify(response));
            },
            error: function (error) {
                console.error('Error submitting form:', error);
            }
        });
        return false;
    }

    function gatherFamilyHistoryData() {
    let familyHistoryData = [];

    // Original container data
    const originalContainer = document.getElementById('FamilyHistoryContainer');
    familyHistoryData.push(getSelectValues(originalContainer));

    // Duplicated containers data
    const duplicatedContainers = document.getElementById('DuplicatedContainerContainer').children;
    for (const container of duplicatedContainers) {
        familyHistoryData.push(getSelectValues(container));
    }

    // Filter out any pairs that contain empty values for familyMember or disorder
    familyHistoryData = familyHistoryData.filter(pair => pair.familyMember && pair.disorder);

    // Format data as 'familyMemberId,disorderId;familyMemberId,disorderId;...'
    const formattedFamilyHistory = familyHistoryData.map(pair => `${pair.familyMember},${pair.disorder}`).join(';');
    console.log(formattedFamilyHistory);
    return formattedFamilyHistory;
}

function getSelectValues(container) {
    const familyMemberSelect = container.querySelector('select[name^="FamilyMembers"]');
    const disorderSelect = container.querySelector('select[name^="Disorders"]');
    const familyMemberValue = familyMemberSelect ? familyMemberSelect.value : '';
    const disorderValue = disorderSelect ? disorderSelect.value : '';
    return { familyMember: familyMemberValue, disorder: disorderValue };
}



    // function showDiagnosisProcess(message) {
    //     alert(message);
    // }

    document.addEventListener('DOMContentLoaded', function () {
        // your existing JavaScript code here
        fetch('http://localhost:3000/symptoms')
            .then(response => response.json())
            .then(data => {
                const selectElement = document.getElementById('symptoms');
                data.forEach(symptom => {
                    const option = document.createElement('option');
                    option.value = symptom.ID; // Assuming each symptom has an 'id'
                    option.textContent = symptom.Name; // Assuming each symptom has a 'name'
                    selectElement.appendChild(option);
                });
            })
            .catch(error => console.error('Error fetching symptoms:', error));

        fetch('http://localhost:3000/FamilyMembers')
            .then(response => response.json())
            .then(data => {
                const selectElement = document.getElementById('FamilyMembers');
                data.forEach(FamilyMembers => {
                    const option = document.createElement('option');
                    option.value = FamilyMembers.ID; // Assuming each FamilyMember has an 'id'
                    option.textContent = FamilyMembers.Type; // Assuming each FamilyMember has a 'type'
                    selectElement.appendChild(option);
                });
            })
            .catch(error => console.error('Error fetching FamilyMembers:', error)

        ,fetch('http://localhost:3000/Disorders')
            .then(response => response.json())
            .then(data => {
                const selectElement = document.getElementById('Disorders');
                data.forEach(Disorders => {
                    const option = document.createElement('option');
                    option.value = Disorders.ID; // Assuming each symptom has an 'id'
                    option.textContent = Disorders.Name; // Assuming each symptom has a 'type'
                    selectElement.appendChild(option);
                });
            })
            .catch(error => console.error('Error fetching Disorders:', error)
        // Attach the submitForm function to the form's onsubmit event
        ,$('#submit-form').submit(function (event) {
            event.preventDefault(); // Prevents default form submission
            submitForm();
        })));

        const duplicateButton = document.getElementById('DuplicateContainerButton');
        const duplicatedContainer = document.getElementById('DuplicatedContainerContainer');

        duplicateButton.addEventListener('click', function() {
        // Clone the whole container instead of individual selects
        console.log(document.getElementById('FamilyHistoryContainer'));
        const selectContainer = document.getElementById('FamilyHistoryContainer'); // Adjust if there are multiple, maybe use a more specific selector or id
        const clone = selectContainer.cloneNode(true);

        // Iterate through selects within the cloned container to reset their values and adjust their IDs and names
        const selects = clone.querySelectorAll('select');
        selects.forEach((select, index) => {
            select.selectedIndex = 0; // Reset the selected index

            // Generate a unique suffix for ID and name attributes to avoid duplicates
            const uniqueSuffix = Date.now() + "_" + index;
            select.id += `_${uniqueSuffix}`;
            select.name += `_${uniqueSuffix}`;

            // Adjust labels 'for' attribute to match the new select id
            const label = select.previousElementSibling; // Assuming label is directly before select
            if (label && label.tagName === 'LABEL') {
                label.setAttribute('for', select.id);
            }
        });

        // Append the cloned container to the designated duplicated container
        duplicatedContainer.appendChild(clone);
        duplicatedContainer.appendChild(DuplicateContainerButton);
        });
    });
</script>
<script>
    // Existing functions: submitForm(), showDiagnosisProcess(), etc.

    function closeMessageBox() {
        document.getElementById('messageBox').style.display = 'none';
    }

    function showMessage(title, message) {
        document.getElementById('messageBox').style.display = 'flex'; // Show the message box
        document.querySelector('.message-content h2').textContent = title; // Set the message box title
        // document.querySelector('.message-content p').textContent = message; // Set the message text
        document.querySelector('.message-content p').innerHTML = message.replace(/\n/g, '<br>'); // Set the message text, converting newlines to HTML line breaks
    }

    // Modify your existing showDiagnosisProcess or similar function to call showMessage()
    function showDiagnosisProcess(jsonResponse) {
    // Parse the JSON response
    const response = JSON.parse(jsonResponse);

    // Extract the patient insertion result
    const patientInsertionResult = response.patientInsertionResult;

    // Start building the message with patient insertion result
    let message = patientInsertionResult + "\n\nDisorders and Matching Symptoms:\n";

    // Iterate through the disorders comparison result to build the message
    response.disordersComparisonResult.forEach(disorder => {
        message += `${disorder.Name} - Matching Symptoms: ${disorder.MatchingSymptoms}\n`;
    });

    // Use the showMessage function to display the formatted message
    // Assuming 'showMessage' takes a title and a message
    const title = "Preliminary Disorders Based Off Symptoms";
    showMessage(title, message);
    }
</script>
<body>
    <header>
        <div class="container">
            <div id="branding">
                <h1>Neuro Solve</h1>
            </div>
            <nav>
                <ul>
                    <li class="current"><a href="#">Home</a></li>
                    <li><a href="#">About</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <h2>Current Page Title</h2>
    </div>

    <div class="container">
        <form id="submit-form">
            <label for="patientTitle">Title:</label>
            <select id="patientTitle" name="patientTitle">
                <option value="Mr">Mr</option>
                <option value="Mrs">Mrs</option>
                <option value="Miss">Miss</option>
                <option value="Ms">Ms</option>
                <option value="Dr">Dr</option>
            </select>

            <label for="patientFirstName">First Name:</label>
            <input type="text" id="patientFirstName" name="patientFirstName">

            <label for="patientLastName">Last Name:</label>
            <input type="text" id="patientLastName" name="patientLastName">

            <label for="streetAddress">Street Address:</label>
            <input type="text" id="streetAddress" name="streetAddress">

            <label for="city">City:</label>
            <input type="text" id="city" name="city">

            <label for="state">State/Province:</label>
            <input type="text" id="state" name="state">

            <label for="postalCode">Postal Code:</label>
            <input type="text" id="postalCode" name="postalCode">

            <label for="country">Country:</label>
            <input type="text" id="country" name="country">

            <label for="dateOfBirth">Date of Birth:</label>
            <input type="date" id="dateOfBirth" name="dateOfBirth">

            <!-- <label for="familyHistory">Family History:</label>
            <input type="text" id="familyHistory" name="familyHistory"></input> -->

            <label>Family History:</label>
            <div class="select-container" id="FamilyHistoryContainer">
                <div class="select-wrapper" id="FamilyMembersWrapper">
                    <label for="FamilyMembers">Family Member:</label>
                    <select id="FamilyMembers" name="FamilyMembers">
                        <option value="" selected>Please select</option>
                    </select>
                </div>
                <div class="select-wrapper" id="DisordersWrapper">
                    <label for="Disorders">Disorder:</label>
                    <select id="Disorders" name="Disorders">
                        <option value="" selected>Please select</option>
                    </select>
                </div>
            </div>
            <button type="button" id="DuplicateContainerButton">Add More</button>
            <div id="DuplicatedContainerContainer"></div>

            <label for="symptoms">Symptoms:</label>
            <select name="symptoms" id="symptoms" multiple class="symptoms-select" multiple></select>
            <!-- <textarea id="symptoms" name="symptoms"></textarea> -->

            <label for="testResults">Test Results/Reports:</label>
            <input type="text" id="testResults" name="testResults"></input>

            <div class="extra-space"></div>

            <input type="submit" class="button" value="Submit">
        </form>
    </div>
    <div class="message-box" id="messageBox" style="display:none;"> <!-- Initially hidden -->
        <div class="message-content">
            <span class="close-btn" onclick="closeMessageBox()">&times;</span>
            <h2>Message Title</h2>
            <p>This is your message content. You can customize it as needed.</p>
        </div>
    </div>
    <div class="extra-space"></div>
</body>
</html>
